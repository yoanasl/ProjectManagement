<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Document</title>
    <script th:inline="javascript">
        // Function to add new team members
        function addNewTeamMembers() {
            // Get the project ID from the page URL
            const url = window.location.href;
            const projectId = '[[${project.id}]]';

            // Get the selected team members
            const selectedMembers = document.querySelectorAll('input[name="newTeamMembers"]:checked');

            // Convert the selected members into an array of user IDs
            const newTeamMembers = [];
            for (let i = 0; i < selectedMembers.length; i++) {
                newTeamMembers.push(selectedMembers[i].value);
            }

            // Send an AJAX request to add the new team members
            fetch(`/projects/${projectId}/team/add`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    newTeamMembers: newTeamMembers
                })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    // Reload the page after successfully adding new team members
                    location.reload();
                })
                .catch(error => {
                    console.error('There was a problem adding new team members:', error);
                });
        }
    </script>
</head>
<body>
<div class="card" style="width: 600px;">
    <div class="card-body">
        <h1 class="card-title">[[${project.name}]]</h1>
        <h6 class="card-subtitle mb-2 text-muted">[[${project.startDate}]] - [[${project.endDate}]]</h6>
        <p class="card-text">[[${project.description}]]</p>
<!--
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#add-member-modal">Add New Member</button>
-->
        </div>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#add-member-modal">
            Add New Member
        </button>
        <div class="modal fade" id="add-member-modal" tabindex="-1" aria-labelledby="add-member-modal-label" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="add-member-modal-label">Add New Team Member</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- List of available users not in the project -->
                        <ul class="list-group">
                            <li th:each="user : ${availableUsers}" class="list-group-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" th:id="${'user-' + user.id}" th:name="newTeamMembers" th:value="${user.id}">
                                    <label class="form-check-label" th:for="${'user-' + user.id}" th:text="${user.name}"></label>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="addNewTeamMembers()">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
<div class="tasks">
    <div class="taskList">
        <h4 class="card-subtitle mb-2 text-muted">TEAM MEMBERS</h4>
        <ul class="list-group ">
            <li th:each="user : ${team}" class="list-group-item d-flex justify-content-between align-items-start">
                <div class="ms-2 me-auto">
                    <div class="fw-bold">
                        <a  th:text="${user.name}">Task name</a>
                    </div>
                    <span th:text="${user.email}">Description</span>
                </div>
            </li>
        </ul>
    </div>


</div>
</body>
<STYLE>
    .card{
        align-items: center;
        margin: auto;
        margin-top: 50px;
    }
    .taskList{
        width: 350px;
        margin-left: 80px;
    }

    .tasks{
        margin-top: 55px;
        display: flex;
    }
</STYLE>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</html>
